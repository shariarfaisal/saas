# API Design Rules

## URL Structure

```
/api/v1/auth/*              # Public auth endpoints
/api/v1/storefront/*        # Public customer-facing endpoints
/api/v1/restaurants/*       # Partner-authenticated endpoints
/api/v1/orders/*            # Authenticated endpoints
/api/v1/admin/*             # Platform admin endpoints
```

Tenant context comes from middleware (subdomain/JWT/header), NOT from URL path.

## Request/Response Format

**Request:** JSON body, `Content-Type: application/json`

**Success response:**
```json
{
  "data": { ... },
  "meta": { "page": 1, "per_page": 20, "total": 150 }
}
```

**Error response:**
```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "restaurant not found",
    "details": {}
  }
}
```

## HTTP Status Codes

| Code | When |
|------|------|
| 200 | Success (GET, PUT, PATCH) |
| 201 | Created (POST) |
| 204 | No content (DELETE) |
| 400 | Bad request, validation error |
| 401 | Unauthenticated |
| 403 | Forbidden (wrong role/tenant) |
| 404 | Resource not found |
| 409 | Conflict (duplicate) |
| 422 | Unprocessable (business rule violation) |
| 429 | Rate limited |
| 500 | Internal server error |

## Pagination

Use offset-based pagination for list endpoints:
```
GET /api/v1/orders?page=1&per_page=20
```

Return `meta` object with `page`, `per_page`, `total`.

## Idempotency

POST/PATCH requests should support `Idempotency-Key` header.
Backend has `idempotency_keys` table for deduplication.

## Headers

| Header | Purpose |
|--------|---------|
| `X-Tenant-ID` | API client tenant identification |
| `X-Request-ID` | Request tracing (auto-generated by frontend) |
| `Idempotency-Key` | Duplicate request prevention |
| `Authorization` | `Bearer {access_token}` |

Reference: `docs/requirements/10-api-design.md`

---
Path scope: All API endpoints
